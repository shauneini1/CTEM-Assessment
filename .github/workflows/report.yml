name: CTEM Report Validation

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  validate-report:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Report
        run: |
          echo "================================================================"
          echo "        CTEM SECURITY ASSESSMENT REPORT - AUTOMATED SUMMARY     "
          echo "================================================================"
          echo ""
          echo "Assessment Details:"
          echo "  Target IP:        54.74.29.28"
          echo "  Target App:       DVWA (Damn Vulnerable Web Application)"
          echo "  Assessment Date:  November 11-12, 2025"
          echo "  Assessor:         Shaun Daniel Eini"
          echo ""
          echo "================================================================"
          echo "                    EXECUTIVE SUMMARY                           "
          echo "================================================================"
          echo ""
          echo "This assessment identified CRITICAL vulnerabilities including:"
          echo "  - SQL Injection (multiple variants)"
          echo "  - OS Command Injection"
          echo "  - Reflected Cross-Site Scripting (XSS)"
          echo "  - Exposed database credentials"
          echo "  - Missing security controls"
          echo ""
          echo "================================================================"
          echo "              FINDINGS BY SEVERITY                              "
          echo "================================================================"
          echo ""
          echo "CRITICAL (Immediate Action Required - 24h SLA):"
          echo "  [1] SQL Injection - Complete database compromise"
          echo "  [2] Command Injection - Remote code execution confirmed"
          echo "  [3] Exposed Credentials - Plaintext passwords in config files"
          echo ""
          echo "HIGH (Fix within 7 days):"
          echo "  [4] Reflected XSS - Session hijacking potential"
          echo "  [5] DVWA exposed over HTTP - No encryption"
          echo "  [6] Missing Security Headers - Multiple attack vectors"
          echo "  [7] Web Server Misconfigurations - Information disclosure"
          echo ""
          echo "MEDIUM (Fix within 30 days):"
          echo "  [8] Outdated Apache version - Known CVEs present"
          echo "  [9] Application Fingerprinting - Attack surface exposure"
          echo ""
          echo "================================================================"
          echo "                  TECHNICAL SCAN RESULTS                        "
          echo "================================================================"
          echo ""
          
          echo "--- [1] NMAP SCAN RESULTS ---"
          if [ -f "results/nmap.txt" ]; then
            head -30 results/nmap.txt
          else
            echo "WARNING: nmap.txt not found in results/"
          fi
          echo ""
          
          echo "--- [2] NIKTO WEB SCAN RESULTS ---"
          if [ -f "results/nikto.txt" ]; then
            head -30 results/nikto.txt
          else
            echo "WARNING: nikto.txt not found in results/"
          fi
          echo ""
          
          echo "--- [3] DIRECTORY ENUMERATION (GOBUSTER) ---"
          if [ -f "results/gobuster.txt" ]; then
            head -30 results/gobuster.txt
          else
            echo "WARNING: gobuster.txt not found in results/"
          fi
          echo ""
          
          echo "--- [4] HTTP SECURITY HEADERS ---"
          if [ -f "results/headers.txt" ]; then
            cat results/headers.txt
          else
            echo "WARNING: headers.txt not found in results/"
          fi
          echo ""
          
          echo "--- [5] WEB FINGERPRINTING (WHATWEB) ---"
          if [ -f "results/whatweb.txt" ]; then
            cat results/whatweb.txt
          else
            echo "WARNING: whatweb.txt not found in results/"
          fi
          echo ""
          
          echo "================================================================"
          echo "                  PROOF OF CONCEPT EVIDENCE                     "
          echo "================================================================"
          echo ""
          echo "Visual evidence available in /screenshots directory:"
          ls -1 screenshots/*.png 2>/dev/null | wc -l | xargs echo "  Total screenshots:"
          echo ""
          echo "Key PoC files:"
          ls screenshots/*SQL*.png 2>/dev/null | sed 's/^/  - /'
          ls screenshots/*Command*.png 2>/dev/null | sed 's/^/  - /'
          ls screenshots/*xss*.png 2>/dev/null | sed 's/^/  - /'
          echo ""
          
          echo "================================================================"
          echo "                    CTEM PRIORITIZATION                         "
          echo "================================================================"
          echo ""
          echo "Remediation Priority (Risk-based):"
          echo ""
          echo "Priority 1 (Critical - 24h SLA):"
          echo "  - SQL Injection: Enables full DB compromise & data theft"
          echo "  - Command Injection: Allows remote code execution as www-data"
          echo "  - Credential Exposure: Immediate authentication bypass risk"
          echo ""
          echo "Priority 2 (High - 7 day SLA):"
          echo "  - XSS: Session hijacking & phishing attacks"
          echo "  - Missing encryption: MitM attacks & credential interception"
          echo "  - Security headers: Multiple client-side attack vectors"
          echo ""
          echo "Priority 3 (Medium - 30 day SLA):"
          echo "  - Outdated software: Potential for CVE exploitation"
          echo "  - Information disclosure: Aids reconnaissance phase"
          echo ""
          
          echo "================================================================"
          echo "                    VALIDATION STATUS                           "
          echo "================================================================"
          echo ""
          
          MISSING_FILES=0
          
          echo "Required Files Check:"
          [ -d "screenshots" ] && echo "  [OK] screenshots/ directory exists" || { echo "  [FAIL] screenshots/ missing"; MISSING_FILES=$((MISSING_FILES+1)); }
          [ -d "results" ] && echo "  [OK] results/ directory exists" || { echo "  [FAIL] results/ missing"; MISSING_FILES=$((MISSING_FILES+1)); }
          [ -f "README.md" ] && echo "  [OK] README.md exists" || { echo "  [FAIL] README.md missing"; MISSING_FILES=$((MISSING_FILES+1)); }
          
          echo ""
          echo "Evidence Files:"
          [ -f "results/nmap.txt" ] && echo "  [OK] nmap.txt present" || echo "  [WARN] nmap.txt missing"
          [ -f "results/nikto.txt" ] && echo "  [OK] nikto.txt present" || echo "  [WARN] nikto.txt missing"
          [ -f "results/gobuster.txt" ] && echo "  [OK] gobuster.txt present" || echo "  [WARN] gobuster.txt missing"
          
          echo ""
          SCREENSHOT_COUNT=$(ls screenshots/*.png 2>/dev/null | wc -l)
          echo "  Screenshot count: $SCREENSHOT_COUNT"
          
          if [ $SCREENSHOT_COUNT -lt 5 ]; then
            echo "  [WARN] Warning: Less than 5 screenshots found"
          else
            echo "  [OK] Sufficient screenshots present"
          fi
          
          echo ""
          echo "================================================================"
          echo "                    END OF REPORT                               "
          echo "================================================================"
          echo ""
          echo "Full detailed report: Eini_Shaun_CTEM_Report.docx"
          echo "GitHub Repository: https://github.com/shauneini1/CTEM-Assessment"
          echo ""
          echo "Report generated: $(date)"
          echo "================================================================"
